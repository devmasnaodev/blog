---
title: "Instale o TrueNAS Scale no Hyper-v"
slug: "truenas-on-hyper-v"
description: "Primeiros passos com TrueNAS"
pubDate: "2025-04-21"
author: "Rodrigo Gomes"
tags: ["Hyper-V", "TrueNAS"]
heroImage: "/images/2025/04/post-03/cover-truenas-on-hyper-v.avif"
---

import Gallery from "@/components/Gallery/Gallery.astro"

## O que √© o [TrueNAS Scale](https://www.truenas.com/truenas-scale/)?

O TrueNAS SCALE √© uma vers√£o do TrueNAS baseada em Linux, especificamente projetada para oferecer uma plataforma de armazenamento escal√°vel e flex√≠vel para ambientes modernos. Ao contr√°rio do TrueNAS CORE, que √© baseado em FreeBSD, o TrueNAS SCALE foi criado para ser altamente compat√≠vel com containers, virtualiza√ß√£o e aplicativos de c√≥digo aberto. Ele combina o poder do sistema de arquivos ZFS com a flexibilidade e a escalabilidade do Kubernetes e dos containers Docker, permitindo que voc√™ gerencie tanto o armazenamento tradicional quanto os containers em um √∫nico sistema.

## Objetivo do laborat√≥rio

- Instalar o TrueNAS SCALE em um ambiente virtualizado utilizando o Hyper-V.
- Configurar uma rede interna dedicada para o laborat√≥rio, garantindo maior controle sobre os endere√ßos IP atribu√≠dos √†s m√°quinas virtuais.
- Criar discos virtuais para armazenamento em RAID-Z1 e um disco de reserva (spare).
- Configurar a interface de rede do TrueNAS SCALE com um IP est√°tico, permitindo o acesso √† interface web.
- Criar um pool de armazenamento configurando o RAID-Z1 e o disco de reserva.


## Instala√ß√£o no Hyper-V

Neste laborat√≥rio, utilizaremos o Hyper-V como plataforma de virtualiza√ß√£o para a implanta√ß√£o do TrueNAS SCALE. No entanto, vale destacar que a instala√ß√£o tamb√©m pode ser realizada em outros hypervisors, como VMware ESXi, Proxmox ou VirtualBox, de acordo com a prefer√™ncia ou o ambiente dispon√≠vel.

A topologia simulada para este ambiente de testes ser√° composta pelos seguintes discos virtuais:

- 1 disco destinado ao sistema operacional (boot)
- 3 discos para armazenamento em configura√ß√£o RAID-Z1
- 1 disco adicional configurado como disco de reserva (spare)

Antes de iniciar o processo de instala√ß√£o, √© fundamental assegurar que o ambiente Hyper-V esteja corretamente configurado, com suporte a virtualiza√ß√£o aninhada, e que os recursos de hardware alocados √† m√°quina virtual atendam aos requisitos m√≠nimos recomendados pelo TrueNAS SCALE. Isso inclui, entre outros:

- Processador com suporte a virtualiza√ß√£o (Intel VT-x ou AMD-V)
- M√≠nimo de 8 GB de mem√≥ria RAM (recomendado 16 GB para uso com ZFS)
- Espa√ßo em disco adequado para a cria√ß√£o dos volumes virtuais.

## Preparando o ambiente

> ‚ö†Ô∏è **Importante:** Durante este guia, utilizaremos comandos via **PowerShell** para otimizar tarefas repetitivas e agilizar o processo de configura√ß√£o. Certifique-se de executar o **PowerShell com privil√©gios de administrador**, a fim de evitar problemas relacionados a permiss√µes.

Caso prefira, todos os procedimentos descritos tamb√©m podem ser realizados atrav√©s da **interface gr√°fica (GUI)** do Hyper-V e do sistema operacional


### Endere√ßamentos de rede

Para uma gest√£o mais eficiente dos endere√ßamentos de rede no ambiente de laborat√≥rio, √© recomend√°vel a cria√ß√£o de uma rede interna dedicada. Essa abordagem permite maior controle sobre os endere√ßos IP atribu√≠dos √†s m√°quinas virtuais, al√©m de evitar conflitos com outras redes em uso no host.

```powershell
# 1. Criar switch interno
New-VMSwitch -SwitchName "vSwitchInterno" -SwitchType Internal

# 2. Configurar IP da interface vEthernet do host
New-NetIPAddress -IPAddress 192.168.100.1 -PrefixLength 24 -InterfaceAlias "vEthernet (vSwitchInterno)"

# 3. Habilitar NAT
New-NetNat -Name "vNatInterno" -InternalIPInterfaceAddressPrefix 192.168.100.0/24
```

‚ö†Ô∏è **Importante:** Certifique-se de que n√£o existam regras de NAT anteriores com o mesmo prefixo de rede para evitar conflitos. Voc√™ pode verificar as regras existentes com o comando `Get-NetNat.`

Ap√≥s a configura√ß√£o voc√™ pode consultar o novo Switch Virtual criado com o comando `Get-VMSwitch`

![Get-VMSwitch](/images/2025/04/post-03/01-truenas-on-hyper-v.avif)

### Crie os discos Virtuais

No exemplo vamos criar 4 discos virtuais para o armazenamento, com os comandos abaixo

```powershell
# Diret√≥rio onde os discos ser√£o criados
$directory = "E:\Hyper-V\VHD\LabTrueNAS" # Altere para o caminho desejado

# Certifique-se de que o diret√≥rio existe
New-Item -ItemType Directory -Path $directory -Force | Out-Null

# Criar 3 discos dinamicamente alocados de 64GB para Raid Z1
for ($i = 1; $i -le 3; $i++) {
    $path = Join-Path $directory "Disk$i.vhdx"
    New-VHD -Path $path -SizeBytes 64GB -Dynamic
}

# Criar 1 disco dinamicamente alocado de 64GB para Spare
$path = Join-Path $directory "Spare.vhdx"
New-VHD -Path $path -SizeBytes 64GB -Dynamic
```

Caso todos os comandos sejam executados corretamente, os arquivos `.vhdx` correspondentes estar√£o dispon√≠veis no diret√≥rio de destino especificado.

![Discos criados](/images/2025/04/post-03/02-truenas-on-hyper-v.avif)

### Crie a maquina virtual

Para este laborat√≥rio, a cria√ß√£o da m√°quina virtual ser√° realizada utilizando o **Gerenciador do Hyper-V**, considerando a simplicidade do procedimento. Abaixo est√£o os par√¢metros recomendados para a configura√ß√£o da VM:

- **Nome:** `TrueNAS Scale - LAB`
- **Gera√ß√£o:** `2¬™ Gera√ß√£o (Generation 2)`
- **Mem√≥ria:** `12.288 MB (12 GB)` ‚Äì ative a op√ß√£o de **aloca√ß√£o din√¢mica de mem√≥ria**
- **Rede:** Conectada ao switch virtual `vSwitchInterno`
- **Disco R√≠gido:** Utilize as configura√ß√µes padr√£o sugeridas pela interface
- **Sistema Operacional:** Selecione a **ISO do TrueNAS Scale**, que pode ser [baixada diretamente no site oficial](https://www.truenas.com/download-truenas-scale/)
    
<Gallery 
  images={[
    { image: "/images/2025/04/post-03/03-truenas-on-hyper-v.avif", alt: "Especificar nome e Local"},
    { image: "/images/2025/04/post-03/04-truenas-on-hyper-v.avif", alt: "Especificar Gera√ß√£o" },
    { image: "/images/2025/04/post-03/05-truenas-on-hyper-v.avif", alt: "Atribuir Mem√≥ria" },
    { image: "/images/2025/04/post-03/06-truenas-on-hyper-v.avif", alt: "Configurar Rede" },
    { image: "/images/2025/04/post-03/07-truenas-on-hyper-v.avif", alt: "Conectar Disco R√≠gido Virtual" },
    { image: "/images/2025/04/post-03/08-truenas-on-hyper-v.avif", alt: "Op√ß√µes de Instala√ß√£o" },
    { image: "/images/2025/04/post-03/09-truenas-on-hyper-v.avif", alt: "Resumo" },
  ]}
/>

> üí° Lembre-se de que os discos de armazenamento adicionais ser√£o inseridos posteriormente, conforme descrito nas pr√≥ximas etapas do guia.
> 

Em configura√ß√µes da maquina virtual rec√©m criada desative as op√ß√µes

- Seguran√ßa ‚Üí Inicializa√ß√£o Seguro (Desabilitado)
- Pontos de verifica√ß√£o ‚Üí Habilitar pontos de verifica√ß√£o (Desabilitado)

<Gallery 
  images={[
    { image: "/images/2025/04/post-03/10-truenas-on-hyper-v.avif", alt: "Seguran√ßa ‚Üí Inicializa√ß√£o Seguro"},
    { image: "/images/2025/04/post-03/11-truenas-on-hyper-v.avif", alt: "Pontos de verifica√ß√£o" },
  ]}
/>

Crie um novo controlador SCSI independente para os discos de armazenamento e anexe todos os discos criados anteriormente.

![Discos adicionais](/images/2025/04/post-03/12-truenas-on-hyper-v.avif)

## Instala√ß√£o do TrueNAS.

Procedimentos de instala√ß√£o.

- Inicie a VM
- **Selecione:** Start TrueNAS SCALE Installation
- **Console Setup:** (1) Install/Upgrade
- **Choose Destination Media:** [*] sda Virtual Disk ‚Äî 127GiB
- **TrueNAS Installation:** < Yes >
- **Web UI Authentication Method:** (1) Administrative User (truenas_admin)
- Crie a senha administrativa e confirme
- **Console Setup:** (3) Reboot System

<Gallery 
  images={[
    { image: "/images/2025/04/post-03/13-truenas-on-hyper-v.avif", alt: "Selecione: Start TrueNAS SCALE Installation"},
    { image: "/images/2025/04/post-03/14-truenas-on-hyper-v.avif", alt: "Console Setup: (1) Install/Upgrade"},
    { image: "/images/2025/04/post-03/15-truenas-on-hyper-v.avif", alt: "Choose Destination Media: [*] sda Virtual Disk ‚Äî 127GiB"},
    { image: "/images/2025/04/post-03/16-truenas-on-hyper-v.avif", alt: "TrueNAS Installation: < Yes >"},
    { image: "/images/2025/04/post-03/17-truenas-on-hyper-v.avif", alt: "Web UI Authentication Method: (1) Administrative User (truenas_admin)"},
    { image: "/images/2025/04/post-03/18-truenas-on-hyper-v.avif", alt: "Crie a senha administrativa e confirme"},
    { image: "/images/2025/04/post-03/19-truenas-on-hyper-v.avif", alt: "Instala√ß√£o finalizada"},
    { image: "/images/2025/04/post-03/20-truenas-on-hyper-v.avif", alt: "Console Setup: (3) Reboot System"}
  ]}
/>

### Configura√ß√£o da interface de rede.

Assim que a instala√ß√£o for conclu√≠da e a inst√¢ncia do TrueNAS estiver reiniciado ser√° necess√°rio configurar a interface de rede com um IP est√°tico sendo que estamos utilizando um Switch Customizado que n√£o possui DHCP

- **Selecione a op√ß√£o:** 1) Configure network interfaces
- **Selecione a interface de rede:** eth0
- **Defina ipv4_dhcp:** No
- **Selecione aliases:**
- **Defina o IP:** 192.168.100.10/24
- **Salve as configura√ß√µes:** < Save >
- **Aplique as configura√ß√µes:** < a >
- **Persista as configura√ß√µes:** < p >
- **Confirme para sair do assistente:** < q > 

<Gallery 
  images={[
    { image: "/images/2025/04/post-03/21-truenas-on-hyper-v.avif", alt: "Selecione: Start TrueNAS SCALE Installation"},
    { image: "/images/2025/04/post-03/22-truenas-on-hyper-v.avif", alt: "Console Setup: (1) Install/Upgrade"},
    { image: "/images/2025/04/post-03/23-truenas-on-hyper-v.avif", alt: "Choose Destination Media: [*] sda Virtual Disk ‚Äî 127GiB"},
    { image: "/images/2025/04/post-03/24-truenas-on-hyper-v.avif", alt: "TrueNAS Installation: < Yes >"},
    { image: "/images/2025/04/post-03/25-truenas-on-hyper-v.avif", alt: "Web UI Authentication Method: (1) Administrative User (truenas_admin)"},
    { image: "/images/2025/04/post-03/26-truenas-on-hyper-v.avif", alt: "Crie a senha administrativa e confirme"},
    { image: "/images/2025/04/post-03/27-truenas-on-hyper-v.avif", alt: "Instala√ß√£o finalizada"},
    { image: "/images/2025/04/post-03/28-truenas-on-hyper-v.avif", alt: "Console Setup: (3) Reboot System"},
    { image: "/images/2025/04/post-03/29-truenas-on-hyper-v.avif", alt: "Console Setup: (3) Reboot System"}
  ]}
/>

## Primeiros passos ap√≥s a instala√ß√£o

Neste ponto, a interface de rede do TrueNAS SCALE estar√° configurada com o IP est√°tico, e o acesso √† interface web pode ser feito atrav√©s do navegador diretamente pelo host.

Vamos acessar a interface web do TrueNAS SCALE atrav√©s do IP configurado `http://192.168.100.10`, e realizar o login com o usu√°rio `truenas_admin` e a senha definida durante a instala√ß√£o.

![Realize o Login](/images/2025/04/post-03/30-truenas-on-hyper-v.avif)

### Configura√ß√£o de DNS

Ap√≥s o login, √© importante configurar o DNS para garantir que o TrueNAS SCALE possa resolver nomes de dom√≠nio corretamente. Isso √© essencial para a comunica√ß√£o com outros servi√ßos.

- Acesse Network ‚Üí Global Configuration ‚Üí Settings
- Defina o DNS Server como
  - NS1: `1.1.1.1`
  - NS2: `1.0.0.1`
- Default Gateway: `192.168.100.1`

<Gallery 
  images={[
    { image: "/images/2025/04/post-03/31-truenas-on-hyper-v.avif", alt: "Acesse Network ‚Üí Global Configuration ‚Üí Settings"},
    { image: "/images/2025/04/post-03/32-truenas-on-hyper-v.avif", alt: "Configure o DNS Server e Default Gateway"},
    { image: "/images/2025/04/post-03/33-truenas-on-hyper-v.avif", alt: "Configura√ß√µes aplicadas com sucesso"}
  ]}
/>

### Configura√ß√£o de Armazenamento

Agora que o TrueNAS SCALE est√° instalado e configurado, √© hora de adicionar os discos virtuais criados anteriormente para formar um pool de armazenamento. Isso permitir√° que voc√™ utilize o ZFS para gerenciar seus dados de forma eficiente e segura.

Nos iremos utilizar 3 discos virtuais de 64GB para criar um pool de armazenamento em RAID-Z1, e um disco adicional de 64GB como disco de reserva (spare).

> Outra op√ß√µes como (logs, cache e deduplica√ß√£o) n√£o ser√£o abordadas neste guia, mas podem ser configuradas posteriormente conforme a necessidade.

- Verifique os discos dispon√≠veis para configura√ß√£o em:
  - Storage ‚Üí `Disks`
- Para criar o pool de armazenamento, acesse:
  - Storage ‚Üí `Create Pool`
- **General Info**, defina o nome do pool como `Datastore`
  - Encryption: `Disabled`
- **Data** Defina o tipo do pool como `RAID-Z1`
  - Disk Size: `64 GiB`
  - Width*: `3`
  - Number of vDEVs*: `1`
- **Spare** (optional)
  - Disk Size*: `64 GiB`
  - Width*: `1`
- Revise as configura√ß√µes e clique em `Create Pool` para criar o pool de armazenamento.
  - Confirme o Warning de formata√ß√£o dos discos

<Gallery 
  images={[
    { image: "/images/2025/04/post-03/34-truenas-on-hyper-v.avif", alt: "Storage Dashboard"},
    { image: "/images/2025/04/post-03/35-truenas-on-hyper-v.avif", alt: "Verifique os discos dispon√≠veis para configura√ß√£o"},
    { image: "/images/2025/04/post-03/36-truenas-on-hyper-v.avif", alt: "Em Data Defina o tipo do pool como `RAID-Z1`"},
    { image: "/images/2025/04/post-03/37-truenas-on-hyper-v.avif", alt: "Em Spare (optional)"},
    { image: "/images/2025/04/post-03/38-truenas-on-hyper-v.avif", alt: "Revise as configura√ß√µes e clique em `Create Pool`"},
    { image: "/images/2025/04/post-03/39-truenas-on-hyper-v.avif", alt: "Confirme o Warning de formata√ß√£o dos discos"}
  ]}
/>

> ‚ö†Ô∏è **Importante:** O processo de cria√ß√£o do pool ir√° formatar os discos selecionados, portanto, certifique-se de que n√£o haja dados importantes neles antes de prosseguir.

![Pool criado com sucesso](/images/2025/04/post-03/40-truenas-on-hyper-v.avif)

Este √© o resultado final do pool criado com sucesso, e agora voc√™ pode come√ßar a utilizar o TrueNAS SCALE para gerenciar seu armazenamento de forma eficiente e segura, lembrando que o TrueNAS SCALE tamb√©m oferece suporte a containers e virtualiza√ß√£o, permitindo que voc√™ expanda ainda mais suas capacidades de armazenamento e gerenciamento de dados.

## Considera√ß√µes Finais

O Objetivo deste laborat√≥rio foi proporcionar uma introdu√ß√£o pr√°tica ao TrueNAS SCALE, permitindo que voc√™ explore suas funcionalidades e comece a utiliz√°-lo em seu ambiente de testes. √Ä medida que voc√™ se familiariza com a interface e os recursos do TrueNAS SCALE, considere explorar outras funcionalidades avan√ßadas, como snapshots, replica√ß√£o e integra√ß√£o com servi√ßos de nuvem.

Se encontrou algum erro ou deseja sugerir melhorias, acesse o reposit√≥rio do projeto no Github e fique √† vontade para contribuir. Agrade√ßo por acompanhar este guia e espero que tenha sido √∫til para voc√™.


